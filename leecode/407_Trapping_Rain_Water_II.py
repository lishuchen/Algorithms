#!/usr/bin/env python
# -*- coding: UTF-8 -*-
import heapq


class Solution(object):
    def trapRainWater(self, heightMap):
        """
        :type heightMap: List[List[int]]
        :rtype: int
        """
        if not heightMap:
            return 0
        n_rows = len(heightMap)
        n_cols = len(heightMap[0])
        size = n_rows * n_cols
        visit_map = [[0 for _ in range(n_cols)] for _ in range(n_rows)]

        # min heap, element:[val, i, j]
        h = []
        for i in range(n_rows):
            heapq.heappush(h, [heightMap[i][0], i, 0])
            heapq.heappush(h, [heightMap[i][n_cols - 1], i, n_cols - 1])
            visit_map[i][0] = 1
            visit_map[i][n_cols - 1] = 1
            if i == 0 or i == n_rows - 1:
                for j in range(1, n_cols - 1):
                    heapq.heappush(h, [heightMap[i][j], i, j])
                    visit_map[i][j] = 1

        x = [1, -1, 0, 0]
        y = [0, 0, 1, -1]
        total = 0
        while h:
            node = heapq.heappop(h)
            val = node[0]
            node_x = node[1]
            node_y = node[2]
            for i in range(4):
                check_x = node_x + x[i]
                check_y = node_y + y[i]
                if 0 <= check_x < n_rows and 0 <= check_y < n_cols and visit_map[check_x][check_y] == 0:
                    if heightMap[check_x][check_y] <= val:
                        total += val - heightMap[check_x][check_y]
                        # this step is vital
                    heapq.heappush(h, [max(val, heightMap[check_x][check_y]), check_x, check_y])
                    visit_map[check_x][check_y] = 1

        return total

if __name__ == "__main__":
    s = Solution()
    print(s.trapRainWater([[1,4,3,1,3,2],[3,2,1,3,2,4],[2,3,3,2,3,1]]))
    print(s.trapRainWater([[12,13,1,12],[13,4,13,12],[13,8,10,12],[12,13,12,12],[13,13,13,13]]))
    print(s.trapRainWater([[1107,1100,1106,1107,1102,1102,1106,1109,1106,1102,1106,1102,1103,1109,1107,1105,1105,1107,1104,1107,1101,1105,1102,1103,1108,1107,1102,1101,1109,1109,1103,1107,1101,1100,1106,1106,1104,1104,1105,1100,1106,1103,1105,1100,1104,1102,1107,1109,1101,1104],[1108,352,229,970,405,497,739,960,138,801,821,914,400,445,94,666,381,688,421,898,481,429,371,26,291,195,470,399,276,721,453,744,63,24,56,810,511,785,760,991,928,572,895,318,359,979,327,730,10,738],[1100,481,509,331,849,791,868,309,532,134,20,327,868,73,341,914,873,194,41,976,175,960,890,413,268,239,734,585,959,734,665,271,557,517,592,396,298,802,695,172,926,705,841,136,120,524,40,984,708,71],[1102,225,21,182,628,632,411,705,559,712,429,215,973,977,74,907,363,714,699,401,876,615,448,59,741,559,573,123,885,623,536,177,838,900,349,809,522,102,856,423,804,275,980,119,594,44,16,948,748,705],[1101,966,662,129,15,745,678,578,210,905,543,736,424,724,978,763,875,490,207,721,256,1001,986,226,110,571,261,468,861,351,515,894,308,519,13,313,254,34,234,806,929,767,885,344,833,853,449,698,686,647],[1109,932,990,738,500,443,651,751,901,502,445,407,386,743,916,741,398,513,765,622,309,37,732,536,723,555,380,162,244,56,151,995,330,132,723,820,565,364,914,808,856,349,205,584,82,464,316,470,967,423],[1105,618,450,509,145,163,54,867,668,640,913,809,626,233,283,339,395,190,694,299,989,892,638,536,819,62,990,477,875,299,890,300,260,683,799,747,188,195,604,846,826,859,998,442,434,623,771,819,156,807],[1109,135,42,89,13,851,142,994,318,1007,635,550,649,885,575,790,622,754,975,568,942,791,417,282,575,841,896,689,1003,42,486,102,519,518,181,874,711,665,210,19,14,836,912,653,63,477,433,28,573,751],[1106,506,532,994,130,450,177,16,129,170,400,957,614,261,818,138,126,519,793,326,881,798,504,783,793,558,602,569,576,166,310,152,14,184,488,134,624,1008,493,743,168,235,43,773,487,851,253,955,360,36],[1103,231,176,118,356,312,18,301,871,584,457,171,78,813,345,909,937,960,907,420,45,417,998,78,532,475,271,775,772,622,154,385,195,672,845,894,974,853,185,835,779,984,996,200,787,684,99,714,986,348],[1107,373,755,465,794,630,282,55,395,396,667,891,123,205,554,959,89,518,154,264,696,276,590,34,466,367,708,555,423,36,245,242,400,990,49,184,962,673,229,348,59,239,581,173,786,125,474,865,986,970],[1101,672,236,51,48,692,760,99,589,173,125,824,406,867,157,445,41,109,109,613,799,510,194,371,25,322,838,841,177,166,802,990,180,28,383,219,63,133,308,994,296,423,809,44,633,308,832,16,759,283],[1109,901,783,155,614,151,467,442,982,986,951,774,318,121,145,691,330,550,814,628,534,453,394,685,839,17,983,661,23,85,286,985,976,412,482,932,553,292,716,525,620,657,642,929,769,129,962,89,669,119],[1100,193,914,444,869,743,803,194,747,168,621,23,495,939,425,968,861,968,602,568,836,212,215,468,483,974,587,436,406,598,545,456,781,801,242,992,534,35,529,271,545,140,637,31,422,52,341,273,363,933],[1101,189,487,389,999,961,353,928,739,749,516,626,547,639,417,779,622,293,156,493,907,692,975,534,65,387,928,748,651,281,671,824,812,500,203,153,803,899,71,532,990,577,500,528,207,907,649,171,543,796],[1104,440,830,971,964,237,349,882,975,342,506,988,156,660,830,350,804,624,591,217,498,571,785,989,441,334,238,81,847,771,219,491,553,391,452,507,618,143,732,935,475,228,913,622,230,85,314,24,699,247],[1102,540,808,359,519,240,35,99,311,872,213,872,705,756,253,499,606,861,633,328,786,450,898,41,414,470,116,70,837,158,307,411,688,106,760,549,688,137,990,341,999,193,203,46,292,446,535,240,297,510],[1108,425,951,798,808,707,258,266,768,85,766,65,838,444,513,588,335,191,67,316,522,408,851,715,444,133,151,322,363,790,174,263,557,467,403,707,165,1004,316,923,431,72,330,260,859,834,190,184,15,248],[1100,528,646,332,585,433,807,727,745,513,859,909,118,759,367,512,456,522,506,762,787,279,825,107,529,674,931,710,200,289,948,681,807,936,355,734,359,152,803,94,1007,653,346,116,402,703,618,200,567,466],[1103,344,735,120,441,607,136,715,307,326,994,597,349,143,875,694,867,577,189,661,661,186,656,349,644,48,394,604,238,951,412,533,637,490,643,69,87,121,126,736,438,110,675,129,595,540,814,452,107,345],[1105,111,873,101,802,860,491,187,454,72,128,857,595,756,337,581,167,414,44,635,492,824,87,157,944,672,39,100,466,489,435,912,590,650,355,382,500,189,911,945,251,30,144,188,128,823,759,285,579,146],[1102,61,960,339,208,894,1001,589,984,809,68,761,711,1000,754,409,373,244,588,274,531,181,646,17,359,764,830,461,391,399,597,643,450,547,324,1000,432,315,580,758,115,990,862,168,981,606,919,696,192,849],[1102,66,20,949,73,370,55,894,173,789,283,760,774,76,297,89,418,71,746,988,172,203,321,24,714,292,972,623,978,154,815,280,210,825,571,626,537,617,510,700,748,135,802,512,553,442,943,962,503,680],[1102,17,225,603,383,929,237,345,895,205,842,700,476,394,867,389,10,747,996,862,437,86,340,230,589,883,662,874,187,507,544,822,867,112,767,240,31,995,928,268,190,112,310,1008,496,168,388,497,905,726],[1101,684,803,31,256,734,257,260,598,786,110,485,598,967,587,356,549,960,341,819,219,873,921,519,872,408,29,250,247,276,318,938,303,111,312,549,187,559,800,776,335,252,251,276,561,828,622,100,778,305],[1102,339,168,173,201,30,923,220,622,160,487,283,441,780,736,743,671,914,644,813,680,321,55,273,587,606,443,551,49,563,198,301,893,357,464,84,729,378,646,694,880,475,967,311,597,693,396,259,597,382],[1102,619,46,460,234,975,56,19,517,447,573,57,738,808,404,545,234,124,913,870,808,135,336,117,789,923,800,527,524,740,900,577,701,936,379,926,901,425,287,760,863,850,808,943,648,554,478,224,20,733],[1105,818,859,763,277,638,676,68,507,543,150,397,110,841,675,831,109,919,246,387,669,451,579,819,737,570,364,205,784,374,929,859,535,130,612,802,110,631,212,607,164,352,347,616,536,12,789,987,921,25],[1104,933,819,934,94,546,494,800,93,620,165,364,470,42,484,424,186,936,397,741,534,903,83,871,861,961,225,640,939,137,1008,293,412,169,569,496,57,405,287,140,16,794,495,828,178,321,242,354,248,982],[1105,772,875,511,985,79,462,200,709,391,679,59,27,433,218,938,920,265,334,549,396,692,333,233,510,853,896,94,197,134,66,625,248,284,478,223,353,930,766,404,664,787,454,33,211,662,961,473,270,637],[1102,1008,319,687,231,819,530,117,904,69,594,312,684,832,586,152,398,281,425,506,676,431,635,472,454,836,124,405,299,736,385,653,734,694,330,307,856,202,767,102,262,351,404,288,525,333,783,265,604,198],[1101,622,971,387,84,415,565,551,162,207,629,537,850,354,574,523,651,420,715,408,512,319,101,906,598,617,581,371,872,176,911,976,140,872,705,567,277,260,460,781,809,79,309,1002,775,873,515,417,283,572],[1107,137,882,259,33,822,866,605,183,80,123,84,46,605,946,741,514,565,344,964,336,143,386,987,135,151,202,992,558,827,907,716,954,131,317,330,943,173,277,116,243,390,542,632,337,478,715,842,385,49],[1108,711,535,524,41,660,18,233,995,566,51,892,624,995,13,931,315,946,446,934,404,32,666,936,654,994,756,359,178,131,751,316,184,276,183,215,278,191,439,615,99,832,497,66,169,852,339,827,140,776],[1101,534,150,408,812,794,392,558,495,560,31,588,218,206,854,391,763,475,924,192,80,14,366,920,70,526,114,399,343,245,517,84,769,657,482,924,441,216,472,279,118,846,857,327,42,54,60,147,871,975],[1102,293,979,38,555,391,554,660,780,887,895,288,314,1006,287,786,920,71,345,735,340,453,571,539,122,955,935,173,92,148,490,116,432,459,145,977,192,689,979,314,919,864,592,223,213,222,351,123,283,686],[1100,613,130,113,494,242,410,772,757,493,910,237,599,332,38,86,652,220,766,621,525,27,828,459,240,31,671,581,496,944,258,687,899,730,790,384,962,191,146,710,26,46,937,967,721,966,396,715,528,152],[1108,43,521,496,493,751,517,506,674,356,441,922,33,330,642,165,56,947,698,544,647,66,933,926,376,644,234,762,701,753,904,369,786,415,856,621,508,715,118,172,61,901,437,436,221,421,944,620,358,632],[1104,347,41,77,264,407,63,840,159,754,583,405,114,712,162,312,675,660,17,783,174,421,26,601,847,590,365,133,200,713,108,344,403,139,764,1009,536,169,839,685,914,765,432,370,467,584,672,484,586,679],[1100,750,442,626,694,632,206,49,755,396,104,853,83,849,982,189,848,860,348,678,887,252,785,309,964,594,883,626,68,459,648,668,552,80,285,588,54,833,979,800,220,73,995,645,265,320,824,103,170,514],[1103,48,109,898,347,63,482,573,680,893,374,670,551,916,92,178,846,137,1002,815,279,564,231,264,199,486,926,365,579,87,869,45,477,968,933,166,22,758,729,44,641,446,56,182,704,138,703,541,617,695],[1106,886,249,919,493,438,395,409,145,317,838,1004,352,305,963,627,814,327,375,885,713,358,321,759,883,16,887,576,547,495,613,235,723,852,145,206,632,882,958,767,541,138,761,883,434,66,853,590,735,570],[1105,438,919,777,187,144,783,65,710,672,902,313,897,967,507,384,164,129,257,464,238,788,592,341,14,368,750,209,948,475,769,756,904,30,523,81,164,648,488,216,662,380,871,549,338,368,276,844,839,875],[1100,419,653,232,751,1009,943,491,560,233,956,320,979,850,692,492,274,199,482,752,405,134,475,619,26,155,977,292,341,159,157,981,568,152,555,661,504,488,142,54,712,441,716,681,633,751,516,897,940,340],[1100,687,465,105,296,833,602,616,115,933,117,614,904,675,756,801,679,250,280,811,647,334,594,353,1005,218,94,863,105,376,194,87,54,1001,534,692,824,126,650,281,49,757,885,295,775,631,87,444,224,709],[1107,861,33,182,556,380,742,641,234,837,359,770,915,403,761,791,86,927,908,78,198,299,826,73,585,591,46,14,377,260,713,964,463,736,488,362,106,220,345,682,48,694,794,305,88,545,438,516,814,336],[1104,1002,626,752,417,553,685,454,909,52,56,612,1007,510,690,837,862,138,48,197,811,438,233,595,733,311,483,513,169,639,840,96,632,808,838,39,703,514,835,602,908,882,556,905,734,236,733,938,364,123],[1107,517,551,700,455,626,1002,280,129,513,909,311,599,531,109,780,913,154,636,738,746,534,962,292,782,686,870,857,614,225,970,81,84,511,772,529,479,116,799,598,619,51,900,561,572,351,683,827,496,309],[1108,232,185,860,867,957,537,727,156,141,294,116,213,721,969,327,240,438,433,382,379,394,423,269,297,337,610,970,507,448,621,405,23,797,255,880,96,782,949,243,266,586,701,821,297,661,138,879,441,561],[1101,810,297,16,421,585,696,374,897,193,812,509,588,825,648,833,47,86,958,987,319,214,563,363,25,850,366,505,719,797,408,313,950,695,671,713,270,357,77,510,540,880,1009,118,47,647,294,85,723,242]]))